// ============================================================================
// Define new processes to add to Kerbalism
// ============================================================================

Profile
{
	name = KerbalismSupport
	modname = Wallum
	moddir = Wallum

	// based of Rational Resources hydrates splitter
	// source: https://github.com/JadeOfMaar/RationalResources/blob/master/GameData/RationalResourcesKerbalism/00_Kerbalism.cfg#L193
	Process
	{
		name = Hydrates Splitter
		modifier = _SplitterHydrates
		input = ElectricCharge@30
		input = Hydrates@0.3014
		output = Water@0.1802
		output = XenonGas@0.0144
		output = ArgonGas@0.8957
		output = Ore@0.0129
		//output = MetalOre@0.0129
		output = Oxygen@68.0851
		dump_valve = XenonGas&ArgonGas&Ore&Oxygen,Water&XenonGas&ArgonGas&Ore,XenonGas&ArgonGas&Ore,Water&ArgonGas&Ore&Oxygen,Water&XenonGas&Ore&Oxygen,Water&XenonGas&ArgonGas&Oxygen
		//dump = XenonGas&ArgonGas&MetalOre&Oxygen,Water&XenonGas&ArgonGas&MetalOre,XenonGas&ArgonGas&MetalOre,Water&ArgonGas&MetalOre&Oxygen,Water&XenonGas&MetalOre&Oxygen,Water&XenonGas&ArgonGas&Oxygen
	}
	
	//  source: https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/20170001808.pdf
	//  source: https://github.com/KSP-RO/ROKerbalism/blob/master/GameData/KerbalismConfig/Profiles/ROKerbalism.cfg#L441
	//  convention: 1 capacity = 36g/hr, just over 1 kerbal worth of Oxygen
	Process
	{
		name = MOXIE
		modifier = _MOXIE
		input = ElectricCharge@0.24
		input = CarbonDioxide@0.01409853921
		output = Oxygen@0.007092198582
		//output = CarbonMonoxide@0.014005 //discarded since we don't use it yet
	}
}

// ============================================================================
// Add Hydrate splitter to ISRU chemical plants
// ============================================================================
@PART[kerbalism-chemicalplant,MiniISRU,ISRU]:HAS[@MODULE[Configure]:HAS[!SETUP[Hydrates?Splitter]]]:NEEDS[ProfileDefault,!RationalResources]:AFTER[Wallum]
{
	MODULE
	{
		name = ProcessController
		resource = _SplitterHydrates
		title = Hydrates Splitter
		capacity = 1
	}

	@MODULE[Configure]
	{
		SETUP
		{
			name = Hydrates Splitter
			desc = Split <b>Hydrates</b> into various resources.
			tech = advScienceTech

			MODULE
			{
				type = ProcessController
				id_field = resource
				id_value = _SplitterHydrates
			}
		}
	}
}

@PART[kerbalism-chemicalplant,MiniISRU,ISRU]:HAS[@MODULE[Configure]:HAS[!SETUP[MOXIE]]]:NEEDS[ProfileDefault,!RationalResources]:AFTER[Wallum]
{
	MODULE
	{
		name = ProcessController
		resource = _MOXIE
		title = MOXIE
		capacity = 1
	}

	@MODULE[Configure]
	{
		SETUP
		{
			name = MOXIE
			desc = Extract <b>Oxygen</b> out of <b>CarbonDioxide</b>.
			tech = advScienceTech

			MODULE
			{
				type = ProcessController
				id_field = resource
				id_value = _MOXIE
			}
		}
	}
}

@PART[kerbalism-chemicalplant]:NEEDS[ProfileDefault,!RationalResources]:AFTER[Wallum]
{
	@MODULE[ProcessController]:HAS[#title[Hydrates?Splitter]]{@capacity = 2.0}
	@MODULE[ProcessController]:HAS[#title[MOXIE]]{@capacity = 2.0}
}

@PART[MiniISRU]:NEEDS[ProfileDefault,!RationalResources]:AFTER[Wallum]
{
	@MODULE[ProcessController]:HAS[#title[Hydrates?Splitter]]{@capacity = 36}
	@MODULE[ProcessController]:HAS[#title[MOXIE]]{@capacity = 36}
}

@PART[ISRU]:NEEDS[ProfileDefault,!RationalResources]:AFTER[Wallum]
{
	@MODULE[ProcessController]:HAS[#title[Hydrates?Splitter]]{@capacity = 90}
	@MODULE[ProcessController]:HAS[#title[MOXIE]]{@capacity = 90}
}

// ============================================================================
// Pseudo-resources used by Kerbalism support for Wallum
// ============================================================================
RESOURCE_DEFINITION:NEEDS[ProfileDefault]//:AFTER[Wallum]
{
	name = _SplitterHydrates
	density = 0.0
	isVisible = false
}

RESOURCE_DEFINITION:NEEDS[ProfileDefault]//:AFTER[Wallum]
{
	name = _MOXIE
	density = 0.0
	isVisible = false
}